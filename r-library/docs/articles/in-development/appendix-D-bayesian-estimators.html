<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Appendix D - Bayesian growth rate and reproduction number estimation â€¢ jepidemic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Appendix D - Bayesian growth rate and reproduction number estimation">
<meta property="og:description" content="jepidemic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">jepidemic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.03</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/generating-synthetic-datasets.html">Generating synthetic datasets</a>
    </li>
    <li>
      <a href="../../articles/getting-started.html">Getting started</a>
    </li>
    <li>
      <a href="../../articles/in-development/appendix-A-validation-methods.html">Appendix A - Reproduction number validation methodology</a>
    </li>
    <li>
      <a href="../../articles/in-development/appendix-B-cori-method-jepidemic.html">Appendix B - Renewal equation reproduction number estimation and Jepidemic implementation validation</a>
    </li>
    <li>
      <a href="../../articles/in-development/appendix-C-incidence-and-growth-rate-estimation.html">Appendix C - Incidence and growth rate estimation</a>
    </li>
    <li>
      <a href="../../articles/in-development/appendix-D-bayesian-estimators.html">Appendix D - Bayesian growth rate and reproduction number estimation</a>
    </li>
    <li>
      <a href="../../articles/in-development/bayesian-growth-rate-2.html">Bayesian growth rate estimation</a>
    </li>
    <li>
      <a href="../../articles/in-development/proportion-and-growth-rate-estimation.html">Appendix C - Proportions and growth rate estimation</a>
    </li>
    <li>
      <a href="../../articles/in-development/two-strain-dynamics.html">Two strain dynamics</a>
    </li>
    <li>
      <a href="../../articles/old/cori-method.html">Cori method</a>
    </li>
    <li>
      <a href="../../articles/old/epiestim-testing.html">Testing epiestim</a>
    </li>
    <li>
      <a href="../../articles/old/growth-rate-estimation.html">Growth rate estimation</a>
    </li>
    <li>
      <a href="../../articles/old/growth-rates.html">Cori method</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Appendix D - Bayesian growth rate and reproduction number estimation</h1>
                        <h4 class="author">Rob Challen</h4>
            
            <h4 class="date">28-01-2022</h4>
      
      
      <div class="hidden name"><code>appendix-D-bayesian-estimators.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In previous appendices we demonstrated approaches to estimating the growth rate using a maximum likelihood estimator, and the effective reproduction number (<span class="math inline">\(R_t\)</span>) using a Bayesian framework with specific assumptions about the exponential growth resulting from the reproduction number. In this section we derive another simpler method for deriving both quantities within a single Bayesian framework, using minimal assumptions about the underlying processes as a counterpoint for comparison. This method is implemented in a Java library with bindings to the R language called "jepidemic", which is open source and available on GitHub <span class="citation">[@rob_challen_2022_5820292]</span>.</p>
</div>
<div id="estimation-of-the-incidence-of-infection" class="section level1">
<h1 class="hasAnchor">
<a href="#estimation-of-the-incidence-of-infection" class="anchor"></a>Estimation of the incidence of infection</h1>
<p>As in previous appendices we assume <span class="math inline">\(I_0, I_1, \dots, I_t\)</span> is a time series of infection counts, assumed to be drawn from some discrete probability distribution with expected value <span class="math inline">\(\overline{I_t}\)</span>. We assume <span class="math inline">\(I_t\)</span> is a Poisson distributed quantity, with a rate parameter which is a function of time:</p>
<p><span class="math display">\[
\begin{aligned}
E[I_t] &amp;= \lambda_t \\
\end{aligned}
\]</span></p>
<p>If we assume <span class="math inline">\(\lambda_t\)</span> is constant over a short time period <span class="math inline">\([t-\tau;t+\tau]\)</span> then by the definition of the Poisson distribution:</p>
<p><span class="math display">\[
\begin{aligned}
P(I_{t-\tau},\dots,I_{t+\tau}|\lambda_t) &amp;= \prod_{s=t-\tau}^{t+\tau}\frac{e^{-\lambda_t}\lambda_t^{I_s}}{I_s!} \\
\end{aligned}
\]</span></p>
<p>Using our knowledge of the conjugate prior of the Poisson distribution we assume the rate parameter, <span class="math inline">\(\lambda_t\)</span>, to be gamma distributed with shape parameter <span class="math inline">\(\alpha\)</span> and rate parameter <span class="math inline">\(\beta\)</span>, and if <span class="math inline">\(n = 2\tau+1\)</span> then we can use a Bayesian framework to derive posterior estimates of the distribution of the Poisson rate, labelled <span class="math inline">\(\alpha'\)</span> and <span class="math inline">\(\beta'\)</span> conditioned on the data we observe over <span class="math inline">\([t-\tau;t+\tau]\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
P(I_{t-\tau},\dots,I_{t+\tau}|\lambda_t) &amp;= \frac{e^{-n\lambda_t}\lambda_t^{\sum{I_s}}}{\prod_{s=t-\tau}^{t+\tau}I_s!} \\
P(\lambda_{t}) &amp;= \frac{\beta^\alpha}{\Gamma(\alpha)} \lambda_{t}^{\alpha-1}e^{-\beta\lambda_{t}} \\
P(\lambda_t|I_{t-\tau},\dots,I_{t+\tau}) &amp;= \frac{P(I_{t-\tau},\dots,I_{t+\tau}|\lambda_t)P(\lambda_{t})}{P(I_{t-\tau},\dots,I_{t+\tau})}\\
P(\lambda_t|I_{t-\tau},\dots,I_{t+\tau}) &amp;= \frac{e^{-n\lambda_t}\lambda_t^{\sum{I_s}}}{\prod_{s=t-\tau}^{t+\tau}I_s!}\frac{\beta^\alpha}{\Gamma(\alpha)} \lambda_{t}^{\alpha-1}e^{-\beta\lambda_{t}}\\
P(\lambda_t|I_{t-\tau},\dots,I_{t+\tau}) &amp;\propto \lambda_t^{\sum{I_s+\alpha-1}}e^{-(2\tau+1+\beta)\lambda_t} \\
P(\lambda_t|I_{t-\tau},\dots,I_{t+\tau}) &amp;\sim \Gamma\big(\sum_{t-\tau}^{t+\tau}{I_s}+\alpha, 2\tau+1+\beta\big)\\
\alpha' &amp;= \alpha+\sum_{t-\tau}^{t+\tau}{I_s}\\
\beta' &amp;= 2\tau+1+\beta
\end{aligned}
\tag{eq:bayesPois}
\]</span></p>
<p>The posterior estimate of the Poisson rate <span class="math inline">\(\lambda\)</span> is gamma distributed by definition. An estimate of the likely value of <span class="math inline">\(I_t\)</span> (<span class="math inline">\(\overline{I_t}\)</span>) given the observed data is given by the posterior predictive distribution:</p>
<p><span class="math display">\[
\begin{aligned}
\overline{I_t} &amp;\sim NegBin\Big(\alpha',\frac{1}{\beta'+1}\Big)\\
E(\overline{I_t}|I_{t-\tau},\dots,I_{t+\tau}) &amp;= \frac{\alpha'}{\beta'} \\
V(\overline{I_t}|I_{t-\tau},\dots,I_{t+\tau}) &amp;= \alpha'\Big(\frac{\beta'+1}{\beta'^2}\Big)
\end{aligned}
\]</span></p>
<!-- There is probably something interesting we can do with the $P(\overline{I_t}|I_{t-\tau} \dots I_{t+\tau})$ to detect importation or anomaly events -->
<!-- N.B. need to talk about prior selection. -->
</div>
<div id="estimation-of-the-growth-rate" class="section level1">
<h1 class="hasAnchor">
<a href="#estimation-of-the-growth-rate" class="anchor"></a>Estimation of the growth rate</h1>
<p>The exponential growth rate <span class="math inline">\(r_t\)</span> is the gradient of the logarithm of <span class="math inline">\(I\)</span> (<span class="math inline">\(\frac{d}{dt}log(\overline{I_t})\)</span>) with respect to time. We approximate this as the difference between two estimates of the true value of <span class="math inline">\(I\)</span> separated by a small time period <span class="math inline">\(2m\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
r_t &amp;\approx \frac{1}{2m}(log(E(I_{t+m}))-log(E(I_{t-m}))) \\
r_t &amp;= \frac{1}{2m}log\frac{\lambda_{t+m}}{\lambda_{t-m}}
\end{aligned}
\]</span></p>
<p>Given that <span class="math inline">\(I\)</span> is assumed to be Poisson distributed the expected value is <span class="math inline">\(\lambda_t\)</span>. If we further define <span class="math inline">\(y = g(r)\)</span> such that:</p>
<p><span class="math display">\[
\begin{aligned}
y = g(r_t) &amp;= e^{2\tau r_t}\\
r_t = g^{-1}(y) &amp;= \frac{1}{2\tau}log(y)\\
\end{aligned}
\]</span></p>
<p>Then we can express the distribution of <span class="math inline">\(g(r)\)</span> in terms of a ratio of Gamma distributed quantities. For simplification we have also assumed that <span class="math inline">\(m=\tau\)</span>. This means that is estimating the growth rate we use two posterior estimates of the Poisson rate based on <span class="math inline">\(\tau+1\)</span> data points. The growth rate estimate is therefore based on <span class="math inline">\(2\tau+1\)</span> data points, as the central point overlaps. This is a choice made to simplify the mathematics but we could have used any 2 estimates which are close together. This approach also has the benefit of not re-using information.</p>
<p><span class="math display">\[
\begin{aligned}
r_t &amp;= \frac{1}{2\tau}log\frac{\lambda_{t+\tau}}{\lambda_{t-\tau}} \\
g(r_t) &amp;\sim \Bigg(\frac{Gamma(\alpha+\sum_{s=t}^{t+2\tau}{I_s}, \beta')}{Gamma(\alpha+\sum_{r=t-2\tau}^{t}{I_r}, \beta')}\Bigg) \\
\alpha'_{\tau+} &amp;= \alpha+\sum_{t}^{t+2\tau}{I_s}\\
\alpha'_{\tau-} &amp;= \alpha+\sum_{t-2\tau}^{t}{I_s}\\
g(r_t) &amp;\sim \Bigg(\frac{
Gamma(\alpha'_{\tau+}, \beta')
}{
Gamma(\alpha'_{\tau-}, \beta')
}
\Bigg)\\
\end{aligned}
\]</span></p>
<p>The ratio of 2 gammas with same rate parameter is a Beta Prime distributed quantity <span class="citation">[@pham-giaDistributionsRatiosRandom2011; @leemisUnivariateDistributionRelationships2008]</span>, which describes <span class="math inline">\(g(r)\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
r_t \sim Y &amp;= \frac{1}{2\tau}log\Big(BetaPrime\big(\alpha'_{\tau+}, \alpha'_{\tau-})\Big) \\
g(r_t) \sim X &amp;= BetaPrime\big(\alpha+\sum_{t}^{t+2\tau}{I}, \alpha+\sum_{t-2\tau}^{t}{I}\big) \\
BetaPrime(\alpha_1, \alpha_2) &amp;: \\
f(x) &amp;= \frac{1}{B(\alpha_1,\alpha_2)}x^{\alpha_1-1}(1+x)^{-\alpha_1-\alpha_2} \\
F(x) &amp;= I_{
\frac{x}{1+x}}(\alpha_1,\alpha_2)
\end{aligned}
\tag{eq:rtBetaP}
\]</span> Where <span class="math inline">\(I\)</span> is the regularised beta function and <span class="math inline">\(B\)</span> is the complete beta function. The support for <span class="math inline">\(g(r_t)\)</span> is <span class="math inline">\([0 \dots \infty]\)</span> and hence the support for <span class="math inline">\(r_t\)</span> is <span class="math inline">\([-\infty \dots \infty]\)</span>. Given that <span class="math inline">\(g(r_t)\)</span> can be differentiated and is a strictly increasing function we can apply the following transformation <span class="citation">[@pishro-nikIntroductionProbabilityStatistics2014; @tabogaFunctionsRandomVariables; @tabogaLecturesProbabilityTheory2017]</span>:</p>
<p><span class="math display">\[
\begin{aligned}
Y &amp;= \frac{1}{2\tau}log(X) \\
g(x) &amp;= \frac{1}{2\tau}log(x) \\
g^{-1}(y) &amp;= e^{2\tau y} \\
\frac{dg^{-1}}{dy} &amp;= 2\tau e^{2\tau y}\\
F_Y(y) &amp;= F_X(g^{-1}(y)) \\
f_Y(y) &amp;= f_X(g^{-1}(y)) \frac{dg^{-1}(y)}{dy}
\end{aligned}
\]</span></p>
<p>Which gives us a probability density function for an estimate of <span class="math inline">\(r_t\)</span> based on the Bayesian posterior of <span class="math inline">\(\lambda_t\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
f_Y(r_t) &amp;= f_X(g^{-1}(r_t))\frac{dg^{-1}(r_t)}{dr_t}\\
f_Y(r_t) &amp;= 2\tau e^{2\tau r_t}f_X(e^{2\tau r_t})\\
f_Y(r_t) &amp;=  2\tau e^{2\tau r_t}\frac{
\Big(
  e^{r_t(\alpha'_{\tau+}-1)}
  (1+e^{r_t})^{(-\alpha'_{\tau+}-\alpha'_{\tau-})}
\Big)}{B(\alpha'_{\tau+}, \alpha'_{\tau-})}\\
f_Y(r_t) &amp;=  \frac{2\tau}{B(\alpha'_{\tau+}, \alpha'_{\tau-})}
\Big(
  e^{r_t(\alpha'_{\tau+}+2\tau-1)}
  (1+e^{r_t})^{(-\alpha'_{\tau+}-\alpha'_{\tau-})}
\Big)\\
\end{aligned}
\]</span></p>
<p>and which has the following cumulative probability function:</p>
<p><span class="math display">\[
\begin{aligned}
F_Y(r_t) &amp;= F_Y(g^{-1}(r_t))\\
F_X(r_t) &amp;= F_Y(e^{2\tau r_t})\\
F_X(r_t) &amp;= I_{
\frac{e^{2\tau r_t}}{1+e^{2\tau r_t}}}(\alpha_{\tau+},\alpha_{\tau-})
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(I_x(a,b)\)</span> is the regularised Beta function <span class="citation">[@weissteinRegularizedBetaFunction]</span>.</p>
<p>The quantile function for <span class="math inline">\(g(r_t)\)</span> is similarly transformed backwards to give a quantile estimate for <span class="math inline">\(r_t\)</span>, and we can sample from <span class="math inline">\(Y\)</span> and transform using <span class="math inline">\(g^{-1}(y)\)</span> to get unbiased samples of <span class="math inline">\(r_t\)</span>.</p>
</div>
<div id="reproduction-number-estimates-from-poisson-rate" class="section level1">
<h1 class="hasAnchor">
<a href="#reproduction-number-estimates-from-poisson-rate" class="anchor"></a>Reproduction number estimates from Poisson rate</h1>
<p>If we continue to assume <span class="math inline">\(I_t \sim Poisson(\lambda_t)\)</span> and an estimate of <span class="math inline">\(\lambda_t\)</span> is available. As before <span class="math inline">\(\omega_1, \omega_2, \dots, \omega_s\)</span> is another probability distribution, the infectivity profile, that defines the likelihood that a case infected at time <span class="math inline">\(t\)</span> resulted from a case infected between the times <span class="math inline">\(t-s\)</span> and <span class="math inline">\(t-s+1\)</span>. This definition implies that <span class="math inline">\(\omega_{s \leq 0} = 0\)</span> as that applies to infections in the future, and that the discrete time measure <span class="math inline">\(s\)</span> here represents the upper bound of the equivalent continuous unit time interval, rather than, for example, the middle of the interval.</p>
<p>As before we define the backward-looking effective reproduction number <span class="math inline">\(R_t\)</span> as the inverse ratio of the number of primary infections associated with secondary infections observed at time <span class="math inline">\(t\)</span>, this is known as the instantaneous reproduction number.</p>
<p><span class="math display">\[
R_t = \frac{\overline{I_t}}{\sum_{s=1}^t \overline{I_{t-s}}\omega_s}
\]</span></p>
<p>The posterior distribution of <span class="math inline">\(\lambda_t\)</span> is an estimate of the <span class="math inline">\(\overline{I_t}\)</span> distribution and therefore .</p>
<p><span class="math display">\[
R_t = \frac{\lambda_t}{\sum_{s=1}^t \lambda_{t-s}\omega_s}
\]</span></p>
<p>assuming the posterior distribution of <span class="math inline">\(\lambda_t \sim Gamma(\alpha',\beta')\)</span> as described above., we consider the denominator as the sum of scaled gamma distributions, and we can say the distribution of the denominator is of the form:</p>
<p><span class="math display">\[
\lambda_{t-s}\omega_s \sim Gamma\big(\alpha'_{t-s}, \frac{\beta'_{t-s}}{\omega_s}\big)\\ 
\]</span></p>
<p>A commonly used approximation for a sum of gamma distributed variables is as another gamma distribution with the same first and second moments as described by in Covo et al. (2014) <span class="citation">[@covoNovelSinglegammaApproximation2014]</span>. In the case of a set of gamma distributions, with parameters <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\beta_i\)</span>, an approximation of the sum is another gamma distribution with parameters <span class="math inline">\(\alpha_{sum}\)</span> and <span class="math inline">\(\beta_{sum}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
E(X_i) &amp;= \frac{\alpha_i}{\beta_i}\\
V(X_i) &amp;= \frac{\alpha_i}{\beta_i^2}\\
E(X_{sum}) &amp;= \sum_iE(X_i) =  \sum_i\frac{\alpha_i}{\beta_i}\\
V(X_{sum}) &amp;= \sum_iV(X_i)= \sum_i\frac{\alpha_i}{\beta_i^2}\\
\alpha_{sum} &amp;= \frac{E(X_{sum})^2}{V(X_{sum})} = \frac{\Big(\sum_i\frac{\alpha_i}{\beta_i}\Big)^2}{\sum_i\frac{\alpha_i}{\beta_i^2}}\\
\beta_{sum} &amp;= \frac{E(X_{sum})}{V(X_{sum})} = \frac{\sum_i\frac{\alpha_i}{\beta_i}}{\sum_i\frac{\alpha_i}{\beta_i^2}}\\
\end{aligned}
\]</span></p>
<p>The moment matching approximation for the sum of gamma distributions can be empirically tested. Here we demonstrate its use on a random set of five gamma distributions show in panel A and the sum of a million random draws from each of these probability distributions in panel B. In panel B the red line is the predicted Gamma distribution based on the estimator. Further validation of the estimator is warranted but in simple cases the estimator is observed to perform well.</p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/gamma-sum-approximation-example-2022-01-28.png" width="885"></p>
<p>Using this approximation we estimate <span class="math inline">\(R_t\)</span> to be distributed as the ratio of 2 Gamma distributions: the numerator with shape and rate parameters <span class="math inline">\(\alpha'\)</span> and <span class="math inline">\(\beta'\)</span>, and the denominator with shape and rate parameters <span class="math inline">\(\alpha''\)</span> and <span class="math inline">\(\beta''\)</span> as described:</p>
<p><span class="math display">\[
\begin{aligned}
R_t &amp;\sim \frac{
  \beta_t'Gamma(\alpha_t',1)
}{
  \beta_t''Gamma(\alpha_t'',1)
}\\
R_t &amp;\sim BetaPrime(\alpha_t',\alpha_t'',1,\frac{\beta_t''}{\beta_t'})\\
\text{Where given: } s \in (1 .. t) &amp;\\
\alpha''_t &amp;= 
\frac{
  \Big(\sum_s \frac{\alpha'_{t-s}\omega_s}{\beta'_{t-s}}\Big)^2
}{
  \sum_s \frac{\alpha'_{t-s}\omega_s^2}{(\beta'_{t-s})^2}
}\\
\beta''_t &amp;= 
\frac{
  \sum_s \frac{\alpha'_{t-s}\omega_s}{\beta'_{t-s}}
}{
  \sum_s \frac{\alpha'_{t-s}\omega_s^2}{(\beta'_{t-s})^2}
}\\
\end{aligned}
\tag{eq:RtGenBetaP}
\]</span></p>
<p>This distributional form of <span class="math inline">\(R_t\)</span> as a generalised Beta Prime distribution <span class="citation">[@BetaPrimeDistribution; @kotzContinuousUnivariateDistributions1995]</span> with three shape parameters (<span class="math inline">\(\alpha_1,\alpha_2,\alpha_3\)</span>) and one scale parameter (<span class="math inline">\(\beta\)</span>) and with the probability density and cumulative probability functions as given below:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Where } BetaPrime(\alpha_1,\alpha_2,\alpha_3,\beta)&amp;: \\
f(x) &amp;= \frac{
\alpha_3\Big(
  1+\big(
    \frac{x}{\beta}
  \big)^{\alpha_3}
\Big)^{-\alpha_1-\alpha_2}
\Big(
  \frac{x}{\beta}
\Big)^{\alpha_1\alpha_3-1}
}
{
\beta Beta(\alpha_1,\alpha_2)
}\\
F(x) &amp;= I_{
  \frac{x^{\alpha_3}}{x^{\alpha_3}+\beta^{\alpha_3}}
}\big(\alpha_1,\alpha_2\big)
\end{aligned}
\]</span></p>
<p>and where <span class="math inline">\(I_x\)</span> is the regularised Beta function. This form for the <span class="math inline">\(R_t\)</span> estimate assumes only the Gamma posterior estimate for the Poisson rate, and so can be readily calculated directly from the analytic form of the posteriors identified in the first part of this method. This could be a biased if the denominator of the ratio is not a good estimate for the weighted sum in reality, however the moment matching estimate works well when the distributions are not completely different. In our case the fact that the <span class="math inline">\(\lambda_t\)</span> estimates are part of the same time series and scaled by the infectivity profile, does make it quite likely the distributions will have similar characteristics.</p>
<p>This constitutes a method for estimating the expected incidence, the growth rate, and the instantaneous reproduction number from a time series of observed case incidence making only a minimal set of assumptions.</p>
</div>
<div id="implementation-considerations" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation-considerations" class="anchor"></a>Implementation considerations</h1>
<p>In <span class="math inline">\(\eqref{eq:bayesPois}\)</span> we derived the standard posterior Gamma distribution of a Poisson rate parameter based on observed cases and a prior belief about that rate (<span class="math inline">\(\lambda_t\)</span>). The prior belief about the rate at time <span class="math inline">\(t\)</span> can be informed by the value of the rate at earlier times, and optionally by the growth rate such that <span class="math inline">\(I_{t+1} = I_te^{r_t}\)</span>. The full distributional forms of the posteriors at previous time steps could be used to generate a prior, but this was found to result in a prior that is far too strong and reflects the the assumption that the Poisson rate is constant over a small time period. Instead of this a better option is a prior that has a very low coefficient of variation, and we found a value of 1 to be appropriate, resulting in the distributional form for the prior, <span class="math inline">\(\lambda_{t+1,prior}\)</span> in terms of the posterior of incidence (<span class="math inline">\(\lambda_{t,posterior}\)</span>) and growth rate (<span class="math inline">\(r_{t,posterior}\)</span>).</p>
<p><span class="math display">\[
\lambda_{t+1,prior} \sim Gamma(1,\frac{
  1
}{
  \overline{\lambda_{t,posterior}} 
  e^{\overline{r_{t,posterior}}}
})
\]</span></p>
<p>This prior will influence the posterior estimates of incidence most strongly when incidence is low, and this may indeed have a desirable stabilising effect on the estimates in this situation. Increasing the coefficient of variation from 1 to a higher number may provide additional stability and is a topic for future exploration.</p>
<p>As stated the method does not account for uncertainty in the infectivity profile <span class="math inline">\(\omega_s\)</span>. This can be included by sampling the infectivity profile, and estimating an <span class="math inline">\(R_t\)</span> distribution for each infectivity profile. The estimator for <span class="math inline">\(R_t\)</span> can be made using any posterior estimate of <span class="math inline">\(\lambda_t\)</span>, for which we have a range of possibilities based on the desired data window (<span class="math inline">\(\tau\)</span>) we wish to use. Much as in Appendix B there are potentially <span class="math inline">\(R_t\)</span> estimates for each of the data window sizes selected for <span class="math inline">\(\lambda_{t,\tau}\)</span> and each of the infectivity profiles. These multiple estimates are combined as a weighted mixture distribution of the multiple <span class="math inline">\(R_t\)</span> estimates, to generate an overall summary estimate while retaining uncertainty By default a uniform weighting is applied but non uniform weighting based on the window size is also a topic for future exploration.</p>
<p>As described in appendix A the case counts may have weekly periodicity, or have anomalous values for other reasons. Within this framework it is possible to adjust the weighting of each data point on a case by case basis, by appropriately adjusting the posteriors in <span class="math inline">\(\eqref{eq:bayesPois}\)</span>. This opens the door for increasing the uncertainty when estimates span weekends, for example, and warrants more investigation.</p>
</div>
<div id="growth-rate-validation" class="section level1">
<h1 class="hasAnchor">
<a href="#growth-rate-validation" class="anchor"></a>Growth rate validation</h1>
<p>The growth rate estimates using this method can be compared to those from the maximum likelihood local polynomial approach described in Appendix C, with a polynomial degree of 2 and window of 14 days. This uses the same synthetic data and methodology as described in Appendix A.</p>
<p>The result of the comparison is shown qualitatively in figure D1, and shows the Bayesian estimator seems to perform well with comparable levels of uncertainty and close matching to the true value</p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/qualitative-bayesian-growth-2022-01-28.png" width="885"></p>
<p><em>Figure D1: qualitative estimates of growth rate (black) against simulated (red) comparing the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C</em></p>
<p>As the growth rate estimates use two estimated of the Poisson rate centered around the time point in question we expect there to be no delay, similar to the locfit method. This is confirmed in figure D2.</p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/lag-bayesian-growth-2022-01-28.png" width="885"></p>
<p><em>Figure D2: time delay analysis of growth rate (black) against simulated (red) comparing the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C</em></p>
<p>Quantitative comparison of the methods shown in Figure D3 and table D1 show the Bayesian method performs slightly better overall than the locfit method as judged by the continuous rank probability score, but with reassuringly little difference between the 2 methods.</p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/error-summary-bayesian-growth-2022-01-28.png" width="885"></p>
<p><em>Figure C3: Estimate quality metric summaries for multiple estimation methods. In this instance we compare the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C. Panel A show summary statistics for the bias of <span class="math inline">\(R_t\)</span> estimates, panel B shows the calibration. Panel C shows the quantile density, panel D the CRPS and panel E the critical threshold calibration.</em></p>
<p><em>Table C1: summary of quantitative analysis of <span class="math inline">\(R_t\)</span> (black) against simulated (red) comparing the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C</em></p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/error-summary-bayesian-growth-table-2022-01-28.png" width="885"></p>
<p>More detailed analysis did not demonstrate any obvious difference between the 2 methods although the Bayesian estimator is unable to produce a growth rate estimate right up to the end of the input time series. This is due to the symmetric nature of the estimation window, which is not a requirement for the locfit estimator.</p>
</div>
<div id="r_t-validation" class="section level1">
<h1 class="hasAnchor">
<a href="#r_t-validation" class="anchor"></a><span class="math inline">\(R_t\)</span> validation</h1>
<p>The derivation of the reproduction number within the Bayesian estimation framework can be compared to estimates from both the locally fitted polynomical locfit approach from Appendix C and the renewal equation approach from Appendix B.</p>
<p>Qualitatively as seen in figure C4 the 3 methods are similar, in that they all faithfully reproduce the true values. A noted in appendix C the locfit method is over-precise compared to the others, and there is little to choose between the Bayesian and renewal equation methods.</p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/qualitative-bayesian-rt-2022-01-28.png" width="885"></p>
<p><em>Figure C4: qualitative estimates of <span class="math inline">\(R_t\)</span> (black) against simulated (red) comparing the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C and the renewal equation method from Appendix B</em></p>
<p>The timing of the estimates showin in Figure C5 are also similar between the Bayesian and renewal equation methods although we note again that the BAyesian method cannot produce estimates up to the end of the timeseries, however this is partly offset by those estimates having less lag.</p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/lag-bayesian-rt-2022-01-28.png" width="885"></p>
<p><em>Figure C5: time delay analysis of <span class="math inline">\(R_t\)</span> (black) against simulated (red) comparing the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C and the renewal equation method from Appendix B</em></p>
<p>Quantitative analysis shows little to separate the renewal equation and this Bayesian method, with the renewal equation method being slightly better calibrated.</p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/error-summary-bayesian-rt-2022-01-28.png" width="885"></p>
<p><em>Figure C6: Estimate quality metric summaries for multiple estimation methods. In this instance we compare the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C and the renewal equation method from Appendix B. Panel A show summary statistics for the bias of <span class="math inline">\(R_t\)</span> estimates, panel B shows the calibration. Panel C shows the quantile density, panel D the CRPS and panel E the critical threshold calibration.</em></p>
<p><em>Table C2: summary of quantitative analysis of <span class="math inline">\(R_t\)</span> (black) against simulated (red) comparing the Bayesian estimator described here with the maximum likelihood Poisson model implementation from Appendix C and the renewal equation method from Appendix B</em></p>
<p><img src="../../../../../../../home/terminological/Dropbox/sarscov2/r-estimation-methodology/error-summary-bayesian-rt-table-2022-01-28.png" width="885"></p>
<p>Detailed breakdowns did not provide any further insight into the differences between the methods.</p>
</div>
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>We introduced an alternative bayesian framework for estimating case incidence, growth rate and reproduction number as the same time. This is robust to a range of different synthetic scenarios and performs in a very similar manner to the locally fitted polynomial for growth rate and to the best performing renewal equation method. The estimates are slightly reduced in valueby the fact they cannot estimate right up to the end of the time series, unlike the other methods, but provide welcome validation by which to benchmark the other methods.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs">

</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rob Challen, terminological.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
